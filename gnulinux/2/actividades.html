<!DOCTYPE html>
<html>
<title>Actividades - GNU/Linux - Administración de red</title>
<meta charset="utf-8">

<!-- themes: 
amelia
bootstrap-responsive
bootstrap
cerulean
cyborg
journal
readable
simplex
slate
spacelab
spruce
superhero
united
-->


<xmp theme="united" style="display:none;">
  ![GNU/Linux](assets/gnulinux.png)
 
  [![cc-by-sa](assets/cc-by-sa.png)](http://creativecommons.org/licenses/by-sa/4.0/)

  2016 - IES Luis Vélez de Guevara - Écija - Spain
 
  La versión más actualizada de este documento se encuentra en [jamj2000.github.io](http://jamj2000.github.io/gnulinux/2/actividades)

<hr>

<a name="indice"></a>



# Índice

#### [Introducción](#introduccion)
#### [Configuración](#configuracion)
#### [Comandos de red](#comandos)
#### [Servicios de red](#servicios)
<pre>


</pre>

En este tema vamos a trabajar mediante el proyecto que se indica a continuación.

El proyecto consiste en __implantar una red virtual__, haciendo uso de __VirtualBox__, siguiendo el esquema que se muestra a continuación:

![Red](assets/red.png)

__Realizaremos la configuración del soporte de red e instalaremos/configuraremos algunos servicios como HTTP, SSH y SAMBA.
Para el soporte de red haremos uso tanto de configuración dinámica como estática.__


#<a name="introduccion"></a> [Introducción](#indice)

1. Utilizando VirtualBox, instala una máquina virtual Linux llamada __servidor-linux__ que tenga 2 tarjetas de red:
 - una tarjeta NAT
 - una tarjeta de red interna
<hr>

1. Utilizando VirtualBox, instala una máquina virtual Linux llamada __cliente-linux__ que tenga 1 tarjeta de red:
 - una tarjeta de red interna
<hr>

1. Utilizando VirtualBox, instala una máquina virtual Linux llamada __cliente-windows__ que tenga 1 tarjeta de red:
 - una tarjeta de red interna
<hr>

1. __Inicia cada una de las máquinas y comprueba/cambia el nombre que tienen por defecto__. A continuación se explica como hacerlo en Linux. Para Windows puedes utilizar la interfaz gráfica (Propiedades del Equipo). En Linux podemos ver el nombre actual con el comando:

 ```sh
 hostname
 ```
 El nombre puede cambiarse de forma temporal con el mismo comando:
 ```sh
 hostname  nuevo_nombre
 ```
 No obstante, si deseamos que los cambios sean permanentes deberemos editar el archivo __/etc/hostname__. Después deberíamos reiniciar para aplicar los cambios, pero NO lo haremos puesto que aún vamos a configurar el listado de equipos de la LAN. El contenido del archivo `/etc/hostname` para servidor_linux sería
 ```
 servidor_linux
 ```
<hr>

1. __Configura el listado de los equipos de la red local.__ Para ello deberás editar el archivo __/etc/hosts__ y añadir las siguientes líneas (igual para los 3 equipos):
 ```
 192.168.1.1   servidor-linux
 192.168.1.10  cliente-windows
 192.168.1.11  cliente-linux
 ```
 En Windows 7 el archivo es `C:\Windows\System32\drivers\etc\hosts`. 
<hr>

1. Reiniciamos las máquinas virtuales. 
```
NOTA: Algunos administradores siguen con el proceso de configuración hasta que alguna tarea les obliga a reiniciar o si no se da este caso entonces hacen un reinicio al final de todas las tareas de configuración. Así evitan los múltiples reinicios.
```
<hr>



<pre>


</pre>

#<a name="configuracion"></a>  [Configuración de red](#indice)

1. __ Archivo /etc/network/interfaces para servidor-linux. __
 ```
 auto lo
 iface lo inet loopback

 auto eth0
 iface eth0 inet dhcp

 auto eth1
 iface eth1 inet static
   address 192.168.1.1
   netmask 255.255.255.0
   network 192.168.1.0
   # dns-nameservers  127.0.0.1 
   # dns-search       velez.local
 ```
 Reiniciamos servicio de red:
 ```
 service  networking  restart
 ```
<hr>

1. __ Archivo /etc/network/interfaces para cliente-linux. __
 ```
 auto lo
 iface lo inet loopback

 auto eth0
 iface eth0 inet static
   address 192.168.1.11
   netmask 255.255.255.0
   network 192.168.1.0
   gateway 192.168.1.1
   # dns-nameservers  192.168.1.1
   dns-nameservers  8.8.8.8  8.8.4.4
 ```
 Reiniciamos servicio de red:
 ```
 service  networking  restart
 ```
<hr>

1. __ Para cliente-windows puedes utilizar el Centro de Redes para realizar la configuración de red. __ 
 Los parámetros son:
 ```
 IP:               192.168.1.10
 MÁSCARA:          255.255.255.0
 PUERTA DE ENLACE: 192.168.1.1
 DNS1:             8.8.8.8
 DNS2:             8.8.4.4 
 ```
<hr>



<pre>


</pre>

#<a name="comandos"></a>  [Comandos de red](#indice)

1. __ Prueba que hay comunicación entre los 3 equipos. __ Por ejemplo, desde servidor-linux realizamos:
```
ping 192.168.1.10
ping 192.168.1.11
```
NOTA: El cortafuegos de Windows tiene desactivada la respuesta a los mensajes ICMP (ping). Deberás añadir una regla al cortafuegos de Windows para que responda a los mensajes ICMP.



<pre>


</pre>

#<a name="servicios"></a> [Servicios de red](#indice) 

1. __ Nombra al menos 5 servicios de red.__ 
<hr>

#### Servicio web
1. __ En servidor-linux instala el paquete apache2. __ Para ello ejecuta
```sh
apt-get  install  apache2
```
<hr>


#### DNS
1. __ En servidor-linux instala los paquetes bind9 y bind9utils.__ Para ello ejecuta 
```sh
apt-get  install  bind9  bind9utils
```
<hr>

1. __ Archivo /etc/bind/named.conf.local __ . Edita el archivo anterior. Debe tener el siguiente contenido: 
 ```
 //
 // Do any local configuration here
 //

 // Consider adding the 1918 zones here, if they are not used in your
 // organization
 //include "/etc/bind/zones.rfc1918";

 // Zona directa
 zone "velez.local" IN {
	type master;
	file "/etc/bind/db.velez.local";
	allow-update { none; };
 };

 // Zona inversa
 zone "1.168.192.in-addr.arpa" IN {
	type master;   
	file "/etc/bind/db.192";   
	allow-update { none; }; 
 };

 ```
<hr>

1. __ Archivo /etc/bind/db.velez.local __ . Edita el archivo anterior. Debe tener el siguiente contenido:

 ```
 ;
 ; BIND:  Zona directa velez.local
 ;
 $TTL    604800
 @                      IN	SOA     velez.local. root.velez.local. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

 ; Servidor DNS
 @                      IN	NS      ns.velez.local.
 ns                     IN	A       192.168.1.1

 ; Otros equipos del dominio
 cliente-windows        IN	A       192.168.1.10
 cliente-linux          IN	A       192.168.1.11

 ; Alias
 servidor-linux         IN	CNAME	ns.velez.local. 
 www                    IN	CNAME	ns.velez.local.
 ftp                    IN	CNAME	ns.velez.local.

 ```
<hr>

1. __ Archivo /etc/bind/db.192 __ . Edita el archivo anterior. Debe tener el siguiente contenido:

 ```
 ;
 ; BIND: Zona inversa de velez.local (192.168.1.0)
 ;
 $TTL    604800
 @       IN     SOA     velez.local. root.velez.local. (
                              2         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative Cache TTL

 ; Servidor DNS
 @       IN     NS      ns.
 1       IN     PTR     ns.velez.local.

 ; Otros equipos del dominio
 10      IN     PTR     cliente-windows.velez.local.
 11      IN     PTR     cliente-linux.velez.local.

 ```
<hr>

1. __Archivo /etc/bind/named.conf.options __ . Si queremos que nuestro servidor DNS se comunique con otros servidores DNS y así poder realizar consultas sobre otros dominios (y no sólo el nuestro), deberemos descomentar/editar las siguientes líneas:
 
 ```
        forwarders {
              8.8.8.8;
              8.8.4.4;
        };
 
 ``` 
Pueden ponerse otros distintos a los indicados. Esto es sólo un ejemplo.
<hr>
 
1. __Comprueba si tienes errores de sintaxis en los archivos anteriores.__ Ejecuta 
```
named-checkconf
```
Si no aparece ningún mensaje, enhorabuena, no tienes errores de sintaxis.
<hr>

1. __Comprueba si tienes errores en la configuración de la zona directa.__ Ejecuta
```
named-checkzone  velez.local  db.velez.local
```
Debe aparecer algo similar a 
```
zone velez.local/IN: loaded serial 1
OK
```
<hr>

1. __Comprueba si tienes errores en la configuración de la zona inversa.__ Ejecuta
``` 
named-checkzone  1.168.192.in-addr.arpa  db.192 
```
Debe aparecer algo similar a 
```
zone 1.168.192.in-addr.arpa/IN: loaded serial 2
OK
```
<hr>

1. __Inicia el servidor de resolución de nombres BIND9. __
```
service  bind9  restart
```
No suele aparecer ningún mensaje en pantalla.
<hr>

1. __Comprueba que el servidor BIND está ejecutandose. __
```
netstat -punta  |  grep named
```
Debe aparecer algo similar a
```
tcp        0      0 192.168.1.1:53          0.0.0.0:*               ESCUCHAR    3856/named      
tcp        0      0 10.0.2.15:53            0.0.0.0:*               ESCUCHAR    3856/named      
tcp        0      0 127.0.0.1:53            0.0.0.0:*               ESCUCHAR    3856/named      
tcp        0      0 127.0.0.1:953           0.0.0.0:*               ESCUCHAR    3856/named      
tcp6       0      0 :::53                   :::*                    ESCUCHAR    3856/named      
tcp6       0      0 ::1:953                 :::*                    ESCUCHAR    3856/named      
udp        0      0 192.168.1.1:53          0.0.0.0:*                           3856/named      
udp        0      0 10.0.2.15:53            0.0.0.0:*                           3856/named      
udp        0      0 127.0.0.1:53            0.0.0.0:*                           3856/named      
udp6       0      0 :::53                   :::*                                3856/named      
```
<hr>

1. __Comprobamos el correcto funcionamiento.__ Desde servidor-linux vamos a realizar algunas consultas.
 ```
 dig  servidor-linux.velez.local   @127.0.0.1 
 ```
 
 Debe aparecer algo parecido a esto

 ```
 ; <<>> DiG 9.9.5-11ubuntu1.3-Ubuntu <<>> servidor-linux.velez.local @127.0.0.1
 ;; global options: +cmd
 ;; Got answer:
 ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 5808
 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1

 ;; OPT PSEUDOSECTION:
 ; EDNS: version: 0, flags:; udp: 4096
 ;; QUESTION SECTION:
 ;servidor-linux.velez.local.	IN	A

 ;; ANSWER SECTION:
 servidor-linux.velez.local. 604800 IN	CNAME	ns.velez.local.
 ns.velez.local.		604800	IN	A	192.168.1.1

 ;; AUTHORITY SECTION:
 velez.local.		604800	IN	NS	ns.velez.local.

 ;; Query time: 2 msec
 ;; SERVER: 127.0.0.1#53(127.0.0.1)
 ;; WHEN: Thu May 19 23:30:57 CEST 2016
 ;; MSG SIZE  rcvd: 102
 ```
 Asegurate de que aparece la __ANSWER SECTION__
<hr>



<pre>


</pre>


</xmp>

<script src="http://jamj2000.github.io/strapdown/strapdown.js"></script>
</html>
